#
# nimbus
# tiddlywiki
#

apiVersion: apps/v1
kind: Deployment
metadata:
  name: tiddlywiki-server
spec:
  replicas: 1
  template:
    spec:
      containers:
        - name: tiddlywiki-server
          image: tiddlywiki
          imagePullPolicy: Always
          volumeMounts:
            - mountPath: /wiki
              name: tiddlywiki-wiki
              # subPath required as tiddlywiki image expects an empty dir
              subPath: tiddlywiki
          ports:
            - name: tiddlywiki-http
              containerPort: 8080
          # tcp socket probe is used instead of http get as http get probes
          # detects a false failure when basic http authentication is enabled.
          readinessProbe:
            initialDelaySeconds: 10
            failureThreshold: 1
            tcpSocket:
              port: tiddlywiki-http
          livenessProbe:
            initialDelaySeconds: 10
            failureThreshold: 1
            tcpSocket:
              port: tiddlywiki-http
      volumes:
        - name: tiddlywiki-wiki
          persistentVolumeClaim:
            claimName: tiddlywiki
