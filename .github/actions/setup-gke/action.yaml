#
# Nimbus
# CI
# Setup GKE Action
#

name: "Setup GKE"
description: "Configures kubectl access to a zonal GKE cluster"
inputs:
  location:
    description: "Location the GKE cluster to access with kubectl."
    default: asia-southeast1-c
  name:
    description: "Name of GKE cluster to access with kubectl."
    default: main
runs:
  using: composite
  steps:
    - id: 'auth'
      name: "Authenticate to GCP with Workload Identity Federation"
      uses: google-github-actions/auth@v1.1.0
      with:
        workload_identity_provider: "projects/652407106283/locations/global/workloadIdentityPools/gh-actions-mrzzy-nimbus/providers/gh-oidc-provider-mrzzy-nimbus"
        service_account: "gh-actions-mrzzy-nimbus@mrzzy-sandbox.iam.gserviceaccount.com"
    - id: 'get-credentials'
      uses: 'google-github-actions/get-gke-credentials@v1.0.1'
      with:
        location: "${{ inputs.location }}"
        cluster_name: "${{ inputs.name }}"
